<!-- include push-notification.js -->

<!doctype html>
<html>
    <head>
        <title>Push Test</title>
        <link rel="manifest" href="/manifest.json">
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
        <script>
            let isSubscribed = false;
            let swRegistration = null;
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyD3TZlq2TIS9C719NhvekAL2LfA-Fsr3h4",
                authDomain: "porkmeter-b3cf2.firebaseapp.com",
                databaseURL: "https://porkmeter-b3cf2.firebaseio.com",
                projectId: "porkmeter-b3cf2",
                storageBucket: "porkmeter-b3cf2.appspot.com",
                messagingSenderId: "615966299981"
            };
            console.log(firebase.initializeApp(config));
            console.log("danach");

            // Retrieve Firebase Messaging object.
            const messaging = firebase.messaging();

            messaging.requestPermission()
            .then(function() {
                console.log('Notification permission granted.');
                // TODO(developer): Retrieve an Instance ID token for use with FCM.
                // Get Instance ID token. Initially this makes a network call, once retrieved
                // subsequent calls to getToken will return from cache.
                messaging.getToken()
                .then(function(currentToken) {
                    if (currentToken) {
                        console.log("current token", currentToken)
                        //sendTokenToServer(currentToken);
                        //updateUIForPushEnabled(currentToken);
                    } else {
                        // Show permission request.
                        console.log('No Instance ID token available. Request permission to generate one.');
                        // Show permission UI.
                        //updateUIForPushPermissionRequired();
                        //setTokenSentToServer(false);
                    }
                })
                .catch(function(err) {
                    console.log('An error occurred while retrieving token. ', err);
                    //showToken('Error retrieving Instance ID token. ', err);
                    //setTokenSentToServer(false);
                });
            })
            .catch(function(err) {
                console.log('Unable to get permission to notify.', err);
            });

            //if ('serviceWorker' in navigator && 'PushManager' in window) {
            //    console.log('Service Worker and Push is supported');
            //    navigator.serviceWorker.register('service-worker.js')
            //    .then(function(swReg) {
            //        console.log('Service Worker is registered', swReg);
            //        swRegistration = swReg;
            //    })
            //    .catch(function(error) {
            //        console.error('Service Worker Error', error);
            //    });
            //} else {
            //    console.warn('Push messaging is not supported');
            //}

            //// Callback fired if Instance ID token is updated.
            //messaging.onTokenRefresh(function() {
            //    messaging.getToken()
            //    .then(function(refreshedToken) {
            //        console.log('Token refreshed.');
            //        // Indicate that the new Instance ID token has not yet been sent to the
            //        // app server.
            //        setTokenSentToServer(false);
            //        // Send Instance ID token to app server.
            //        sendTokenToServer(refreshedToken);
            //        // ...
            //    })
            //    .catch(function(err) {
            //        console.log('Unable to retrieve refreshed token ', err);
            //        showToken('Unable to retrieve refreshed token ', err);
            //    });
            //});
        </script>
    </head>
    <body>
    </body>
</html>